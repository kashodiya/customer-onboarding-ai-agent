<mat-toolbar color="primary" class="navigation-toolbar">
  <span class="app-title">File Transfer Onboarding</span>
  
  <div class="toolbar-spacer"></div>
  
  <!-- Autosaving Indicator -->
  <div *ngIf="isAutosaving" class="autosaving-indicator">
    <mat-spinner diameter="16" color="gray"></mat-spinner>
    <span>Autosaving...</span>
  </div>

  

  <!-- History Dropdown -->
  <button mat-button [matMenuTriggerFor]="historyMenu" class="submissions-button">
    <mat-icon>history_toggle_off</mat-icon>
    <span>History</span>
  </button>

  <mat-menu #historyMenu="matMenu" class="submissions-menu" xPosition="after" yPosition="below">
    <div class="menu-header">
      <h3>History</h3>
    </div>
    <div *ngIf="(history$ | async)?.length === 0" class="no-submissions">
      <mat-icon>inbox</mat-icon>
      <span>No submissions yet</span>
    </div>
    <!-- Drafts on top -->
    <ng-container *ngIf="history$ | async as allHistory">
      <ng-container *ngFor="let draft of getDrafts(allHistory)">
        <button mat-menu-item 
                class="submission-item" 
                [ngClass]="{'current-draft': draft.id === currentDraftId}"
                (click)="onLoadSubmission(draft.id)">
          <div class="submission-content">
            <div class="submission-header">
              <mat-icon class="submission-icon">description</mat-icon>
              <span class="submission-name">{{draft.name}}</span>
              <button mat-icon-button 
                      class="delete-button" 
                      (click)="onDeleteHistorySubmission(draft.id, draft.name, $event)"
                      matTooltip="Delete draft"
                      matTooltipPosition="left">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
            <div class="submission-meta">
              <span class="submission-date">{{draft.timestamp | date:'short'}}</span>
              <span class="submission-status" [class]="draft.status">
                {{draft.status}}
              </span>
            </div>
          </div>
        </button>
      </ng-container>
      <!-- Divider if there are both drafts and submissions -->
      <mat-divider *ngIf="getDrafts(allHistory).length > 0 && getPastSubmissions(allHistory).length > 0"></mat-divider>
      <!-- Past submissions on bottom -->
      <ng-container *ngFor="let submission of getPastSubmissions(allHistory)">
        <button mat-menu-item 
                class="submission-item"
                (click)="onLoadSubmission(submission.id)">
          <div class="submission-content">
            <div class="submission-header">
              <mat-icon class="submission-icon">description</mat-icon>
              <span class="submission-name">{{submission.name}}</span>
              <button mat-icon-button 
                      class="delete-button" 
                      (click)="onDeleteHistorySubmission(submission.id, submission.name, $event)"
                      matTooltip="Delete submission"
                      matTooltipPosition="left">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
            <div class="submission-meta">
              <span class="submission-date">{{submission.timestamp | date:'short'}}</span>
              <span class="submission-status" [class]="submission.status">
                {{submission.status}}
              </span>
            </div>
          </div>
        </button>
      </ng-container>
    </ng-container>
  </mat-menu>
  
  <!-- Templates Dropdown -->
  <button mat-button [matMenuTriggerFor]="submissionsMenu" class="submissions-button">
    <mat-icon>history</mat-icon>
    <span>Templates</span>
    <span matBadge="{{(templates$ | async)?.length || 0}}" matBadgeOverlap="false" 
          matBadgeColor="accent" matBadgeSize="small" class="badge-container"></span>
  </button>
  
  <mat-menu #submissionsMenu="matMenu" class="submissions-menu">
    <div class="menu-header">
      <h3>Templates</h3>
    </div>
    
    <div *ngIf="(templates$ | async)?.length === 0" class="no-submissions">
      <mat-icon>inbox</mat-icon>
      <span>No templates yet</span>
    </div>
    
    <button mat-menu-item 
            *ngFor="let submission of templates$ | async" 
            class="submission-item">
      <div class="submission-content" (click)="onLoadSubmission(submission.id)">
        <div class="submission-header">
          <mat-icon class="submission-icon">
            {{submission.status === 'template' ? 'content_copy' : 'description'}}
          </mat-icon>
          <span class="submission-name">{{submission.name}}</span>
          <button mat-icon-button 
                  class="delete-button" 
                  (click)="onDeleteSubmission(submission.id, submission.name, $event)"
                  matTooltip="Delete submission"
                  matTooltipPosition="left">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
        <div class="submission-meta">
          <span class="submission-date">{{submission.timestamp | date:'short'}}</span>
          <span class="submission-status" [class]="submission.status">
            {{submission.status}}
          </span>
        </div>
      </div>
    </button>
    
    <!-- <mat-divider></mat-divider>
    
    <button mat-menu-item (click)="onImportSubmission()" class="import-button">
      <mat-icon>upload_file</mat-icon>
      <span>Import Submission</span>
    </button>
    
    <button mat-menu-item (click)="onClearDraft()" class="clear-draft-button">
      <mat-icon>clear</mat-icon>
      <span>Clear Current Draft</span>
    </button> -->
  </mat-menu>
  
  <!-- New Form Button -->
  <button mat-button (click)="onNewForm()" class="new-form-button">
    <mat-icon>add</mat-icon>
    <span>New Form</span>
  </button>
</mat-toolbar>

<!-- Hidden file input for importing -->
<input #fileInput type="file" accept=".json" (change)="onFileSelected($event)" style="display: none;"> 